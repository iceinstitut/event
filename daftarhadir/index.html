<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Attendance Registration</title>

<!-- ‚úÖ Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- ‚úÖ QRCode Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
  body {
    background: #f6f7fb;
    font-family: "Segoe UI", sans-serif;
  }

  .brand-header {
    background: linear-gradient(135deg, #b70404, #e70606);
    color: white;
    padding: 30px;
    border-radius: 20px 20px 0 0;
    text-align: center;
  }

  .brand-logo {
    max-height: 80px;
  }

  .gender-option {
  cursor: pointer;
  border: 2px solid transparent;
  transition: 0.3s;
}

.gender-option:hover {
  border-color: #ff4b4b;
  background: #fff5f5;
}

.gender-option.selected {
  border-color: #b70404;
  background: #ffe2e2;
  transform: scale(1.03);
}
</style>
</head>

<body>

<div class="container mt-5">

  <!-- ‚úÖ HEAD BRAND -->
  <div class="card shadow p-0 rounded-4">
    <div class="brand-header">
      <img src="YOUR_EVENT_LOGO_PATH_HERE" class="brand-logo mb-3">
      <h3 id="eventTitle">Event Attendance Form</h3>
      <p class="mb-0">Please fill out attendance information below</p>
    </div>

    <!-- ‚úÖ FORM -->
    <div class="p-4">
      <form id="attendanceForm">
        <div class="row g-3">

          <div class="col-md-6">
            <label>Email Address</label>
            <input type="email" class="form-control" id="email" required>
          </div>

          <div class="col-md-6">
            <label>Event</label>
            <input type="text" class="form-control" id="even" required>
          </div>

          <div class="col-md-6">
            <label>Full Name</label>
            <input type="text" class="form-control" id="fullName" required>
          </div>

          <div class="col-md-6">
  <label class="mb-2 d-block">Gender</label>

  <div class="d-flex gap-3">

    <div class="gender-option card flex-fill text-center p-3 rounded-4"
         data-value="Male" onclick="selectGender(this)">
      <div style="font-size:45px;">‚ôÇÔ∏è</div>
      <strong>Male</strong>
    </div>

    <div class="gender-option card flex-fill text-center p-3 rounded-4"
         data-value="Female" onclick="selectGender(this)">
      <div style="font-size:45px;">‚ôÄÔ∏è</div>
      <strong>Female</strong>
    </div>

  </div>

  <input type="hidden" id="gender" required>
</div>

          <div class="col-md-6">
            <label>Occupation</label>
            <input type="text" class="form-control" id="occupation" required>
          </div>

          <div class="col-md-6">
            <label>Institution</label>
            <input type="text" class="form-control" id="institution" required>
          </div>

          <div class="col-md-6">
            <label>Mobile Phone Number</label>
            <input type="tel" class="form-control" id="mobile" required>
          </div>

          <div class="col-md-4">
            <label>City</label>
            <input type="text" class="form-control" id="city">
          </div>

          <div class="col-md-4">
            <label>Province</label>
            <input type="text" class="form-control" id="province">
          </div>

          <div class="col-md-4">
            <label>Country</label>
            <input type="text" class="form-control" id="country">
          </div>

        </div>

        <button class="btn btn-danger w-100 mt-4" type="submit">Submit Attendance</button>
      </form>

      <p class="text-center mt-3 fw-semibold" id="status"></p>
    </div>
  </div>

  <!-- ‚úÖ QR CODE SECTION -->
  <div class="card shadow mt-4 p-4 rounded-4">
    <h5 class="text-center">QR Check-In Code</h5>
    <div id="qrcode" class="d-flex justify-content-center mt-3"></div>
    <p class="text-center small text-muted mt-2">Scan to open attendance form</p>
  </div>

</div>

<script>
const formURL = "https://script.google.com/macros/s/AKfycbzFKz32zF_-Z2LGXlGEccRYpuaadMTTabrENXCsGy-NyINc-RVWUypEpGhcr2Hf5g1EYg/exec";          // ‚Üê URL Web App dari Apps Script
const publicWebFormURL = window.location.href;   // ‚Üê Auto detect link GitHub Pages

// ‚úÖ Generate QR Code pointing to web form (GitHub Pages)
new QRCode(document.getElementById("qrcode"), {
  text: publicWebFormURL,
  width: 150,
  height: 150,
});

// ‚úÖ Fungsi Icon Gender
function selectGender(el) {
  document.querySelectorAll('.gender-option').forEach(option => {
    option.classList.remove("selected");
  });

  el.classList.add("selected");
  document.getElementById("gender").value = el.getAttribute("data-value");
}

// ‚úÖ AUTO-FILL EVENT FROM URL PARAMETER
function autofillEventFromURL() {
  const params = new URLSearchParams(window.location.search);
  const eventParam = params.get("event");

  if (eventParam) {
    const eventInput = document.getElementById("event");

    // ganti underscore menjadi spasi agar lebih rapi
    const formattedEvent = decodeURIComponent(eventParam).replace(/_/g, " ");

    eventInput.value = formattedEvent;

    // update title event di header brand
    const eventTitle = document.getElementById("eventTitle");
    if (eventTitle) {
      eventTitle.innerText = formattedEvent;
    }
  }
}

// üî• jalankan otomatis saat halaman dibuka
autofillEventFromURL();


// ‚úÖ Submit form ke Google Apps Script
document.getElementById("attendanceForm").addEventListener("submit", function (e) {
  e.preventDefault();

  const data = {
    email: email.value,
    even: even.value,
    fullName: fullName.value,
    gender: gender.value,
    occupation: occupation.value,
    institution: institution.value,
    mobile: mobile.value,
    city: city.value,
    province: province.value,
    country: country.value,
  };

  fetch(formURL, {
    method: "POST",
    body: JSON.stringify(data),
  })
  .then(res => res.json())
  .then(res => {
    status.innerHTML = "‚úÖ Attendance recorded successfully!";
    attendanceForm.reset();
  })
  .catch(() => {
    status.innerHTML = "‚ùå Failed to submit. Try again.";
  });
});
</script>

</body>
</html>