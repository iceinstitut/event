<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Registration</title>

<script>
function loadComponent(id, url) {
    fetch("https://iceinstitut.github.io/konten/" + url)
        .then(response => response.text())
        .then(data => {
            document.getElementById(id).innerHTML = data;
        });
}

document.addEventListener("DOMContentLoaded", function() {
    loadComponent("header", "header.html");
    loadComponent("footer", "footer.html");
});

fetch("https://iceinstitut.github.io/konten/head.html")
    .then(response => response.text())
    .then(data => {
        const temp = document.createElement("div");
        temp.innerHTML = data;

        // Proses <link> langsung
        temp.querySelectorAll("link").forEach(link => {
            document.head.appendChild(link);
        });

        // Proses <script> manual
        temp.querySelectorAll("script").forEach(oldScript => {
            const newScript = document.createElement("script");
            newScript.src = oldScript.src;
            if (oldScript.defer) newScript.defer = true;
            document.head.appendChild(newScript);
        });
    });
</script>



    <style>
        body {
            background: #f6f7fb;
        }

        .card {
            border-radius: 15px;
        }

        .header-title {
            font-size: 28px;
            font-weight: 600;
        }

        #cardContainer {
            transition: opacity .3s ease;
        }

        .attendance-card {
            transition: transform 0.25s, box-shadow 0.25s;
        }

        .attendance-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 16px rgba(0, 0, 0, 0.12);
        }
    </style>
</head>

<body style="background-color:#f6f7fb;">
    <div id="header"></div>
    <div class="container py-5">
        <h2 class="text-center mb-4 header-title">Attendance List</h2>
        <div class="text-center mb-4">
            <div id="totalCount" class="text-muted"></div> <button id="refreshBtn" class="btn btn-danger px-4"><i class="me-2 bi bi-arrow-clockwise"></i>Refresh Data</button>
        </div>


        <div id="cardContainer" class="row g-4 justify-content-center">
            <p class="text-center">Loading data...</p>
        </div>
    </div>


    <script>
        const apiURL = "https://script.google.com/macros/s/AKfycbzFKz32zF_-Z2LGXlGEccRYpuaadMTTabrENXCsGy-NyINc-RVWUypEpGhcr2Hf5g1EYg/exec?action=view"; // <-- ganti dengan URL Apps Script

// ✅ fungsi mengambil data ke Google Apps Script
function loadData() {
  const container = document.getElementById("cardContainer");
  const totalCount = document.getElementById("totalCount");

  container.style.opacity = "0.6";

  fetch(apiURL)
    .then(res => res.json())
    .then(res => {
      const data = res.data;

      data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

      // ✅ tampilkan jumlah data
      totalCount.innerHTML = `Total Participants: <b>${data.length}</b>`;

      let html = "";
      data.forEach(item => {
        html += `
          <div class="col-md-4">
            <div class="card shadow-sm p-3 rounded-4 border-0 attendance-card h-100">
                <small class="text-muted text-end mb-1">${new Date(item.timestamp).toLocaleString()}</small>
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start">
                    <h5 class="fw-bold">${item.fullName}</h5>
                  </div>

                  <div class="mt-2 d-flex flex-wrap gap-2">
                    <span class="badge bg-primary-subtle text-primary-emphasis rounded-pill px-3 py-2 d-flex align-items-center"><i class="me-2 bi bi-person-circle" style="font-size:20px;"></i>${item.gender}</span>
                    <span class="badge bg-success-subtle text-success-emphasis rounded-pill px-3 py-2 d-flex align-items-center"><i class="me-2 bi bi-person-workspace" style="font-size:20px;"></i>${item.occupation}</span>
                    <span class="badge bg-dark-subtle text-dark-emphasis rounded-pill px-3 py-2 d-flex align-items-center"><i class="me-2 bi bi-building" style="font-size:20px;"></i>${item.institution}</span>
                  </div>
              </div>

              <div class="card-footer text-muted mt-3" style="padding:0px; color: NONE; background-color: #fff; border-top: NONE;">${item.even}
              </div>

            </div>
          </div>
        `;
      });

      container.innerHTML = html;
      container.style.opacity = "1";

    })
    .catch(() => {
      container.style.opacity = "1";
    });
}

// ✅ jalankan load pertama kali ketika page dibuka
document.addEventListener("DOMContentLoaded", loadData);

// ✅ tombol refresh tanpa reload page
document.getElementById("refreshBtn").addEventListener("click", function () {
  loadData();
});

// ✅ Auto-refresh setiap 15 detik (bisa diubah)
setInterval(loadData, 30000);
    </script>

    <div id="footer"></div>

</body>

</html>